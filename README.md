# Primeng CDEK

## 1. Обзор

Этот проект является клоном проекта PrimeNG версии 17.18.11. Проект PrimeNG содержит исходный код компонентов и их стили, а также сайт с демонстрацией этих компонентов [PrimeNG](https://primeng.org). Он позволяет просматривать компоненты в разных темах, представленных в виде CSS файлов.

В Primeng CDEK добавлен репозиторий [primeng-sass-theme 17.18.3](https://github.com/primefaces/primeng-sass-theme/tree/17.18.3), который содержит исходные SASS файлы тем и шаблон для создания собственной темы.

Версия NodeJs 18.20

## 2. Структура проекта

-   `primeng-sass-theme/` — исходный код тем CDEK.
-   `primeng-sass-theme/theme-base` — базовые стили компонентов. Все темы наследуются от этих стилей.
-   `primeng-sass-theme/themes/base` — базовые переменные для всех тем.
-   `primeng-sass-theme/themes/base-dark` — базовые переменные для всех тем "dark".
-   `primeng-sass-theme/themes/base-light` — базовые переменные для всех тем "light".
-   `primeng-sass-theme/themes/ek5/base-primary` — базовые переменные ek5 для всех тем "primary".
-   `primeng-sass-theme/themes/ek5/base-secondary` — базовые переменные ek5 для всех тем "secondary".
-   `primeng-sass-theme/themes/brand/base-primary` — базовые переменные brand(для внешних клиентов) для всех тем "primary".
-   `primeng-sass-theme/themes/brand/base-secondary` — базовые переменные brand(для внешних клиентов) для всех тем "secondary".
-   `primeng-sass-theme/themes/ek5` - темы brand(для внешних клиентов).
-   `primeng-sass-theme/themes/ek5` — темы ek5. В настоящее время используются 4 темы: `ek5-light-primary`, `ek5-dark-primary`, `ek5-light-secondary`, `ek5-dark-secondary`. Эти SCSS файлы собирают в себя остальные файлы стилей и отправляются на компиляцию.
-   `src/app/components` — исходный код компонентов PrimeNG.
-   `src/assets/components/themes` — готовые темы в виде CSS файлов.

## 3. Запуск проекта

1. Установить зависимости: `npm install`.
2. Запустить проект: `npm run start`.

## 4. Как формируется итоговый внешний вид компонентов и тема

Помимо темы, компоненты PrimeNG имеют свои стили. Например, кнопка PrimeNG имеет стили в файле `src/app/components/button/button.css`. Эти стили собираются командой Prime в файл `primeng.css`, который подключается в проекте с помощью `@import "primeng/resources/primeng.css";`. При отладке важно понимать, откуда берутся стили компонентов.

Стили темы накладываются поверх этих базовых стилей. Например, тема `ek5-light-primary.scss` импортирует базовые переменные цветов, генератор CSS переменных, а затем стили компонентов. Это позволяет создавать стили на основе определенных переменных для тем.

## 5. Разработка темы

Есть два способа разработки темы:

1. **Компиляция SASS в CSS**:

    - Запустить проект.
    - Запустить компиляцию конкретной темы командой `npm run watch-light-primary` или всех тем сразу с помощью `npm run watch-themes`.
    - Изменить нужный SASS файл темы. Sass отследит изменения и перекомпилирует соответствующий CSS файл.
    - Обновить страницу приложения, чтобы увидеть изменения.

    **Недостаток**: нужно вручную обновлять страницу для просмотра изменений.

2. **Импорт темы в `styles.scss`**:

    - Запустить проект.
    - Импортировать файл темы в `src/styles.scss`:
        ```scss
        @import '../primeng-sass-theme/themes/ek5/ek5-light-primary';
        ```
      или для удобного сравнения компонентов с figma в ДС тему brand для внешних клиентов.        
    - ```scss
        @import '../primeng-sass-theme/themes/brand/brand-light-primary';
    ```      

    - При изменении SASS файла проект автоматически перекомпилируется, и изменения будут отображаться без обновления страницы (HMR).

    **Недостаток**: проект по умолчанию импортирует тему через CSS, что может привести к перекрытию стилей.

## 6. Компиляция темы для использования в других проектах

Команда `npm run build-themes` создаст .min.css файлы для использования в проектах. TODO решить как используем файл темы. С эк?

## 7. FAQ

TODO: Добавлять ответы на часто задаваемые вопросы.

### FAQ по дизайн-системе от дизайнеров в [confluence](https://confluence.cdek.ru/pages/viewpage.action?pageId=122762206)

### 1. Откуда берутся переменные для тем?

**Ответ:** Дизайнеры при разработке дизайн системы используют переменные и задают им значения. Для выгрузки этих переменных из figma был разработан плагин Prime theme exporter https://www.figma.com/community/plugin/1360256675787932572/prime-theme-exporter .
При изменении этих переменных нужно их заново выгрузить и обновить в проекте. Переменные (токены) расположены здесь https://www.figma.com/design/70PmUKyqbgjyd7dfEc3fzs/%F0%9F%9A%A7-Tokens-PrimeFace-(DS)?node-id=1-2&node-type=canvas&t=woE5QhaEskyYclwq-0 и также там есть описание их выгрузки.
Обращаю внимание, что для выгрузки токенов нужны права на редактирование figma-файла.

### 2. А где вообще актуальная дизайн система?

**Ответ:** Тут https://www.figma.com/design/4TYeki0MDLhfPGJstbIicf/UI-kit-PrimeFace-(DS)?node-id=0-1&node-type=canvas&m=dev

Отмечу, что дизайн система разработана не в теме эк5, а в теме Brand(primary) light. Но в песочнице компонента, можно посмотреть компонент в теме эк5. Для этого нужно выбрать компонент в figma и Open in playground.

Также добавлены brand темы, которые можно выбрать в темах или подключить в styles.scss для удобного сравнения с figma в ДС.

### 3. Как то сложно с figma стало, а есть ли что-то про это?

**Ответ:** Тут https://www.figma.com/design/M2h4N5YM7TIlHhyD90esPI/%F0%9F%9A%A7-FAQ-(DS)?node-id=57-475&node-type=canvas&t=a9NXscSgxb3S7TrD-0
Наш дизайнер подготовил FAQ по работе с figma в DevMode.

### 4. Я слышал про какую-то песочницу, что это?

**Ответ:** Дизайнер при разработке дизайн системы хотел проверять работу компонентов и создал react проект с темой.
https://gitlab.cdek.ru/FrontDev/prime-theme-sandbox/-/tree/feature/styles?ref_type=heads

### 5. А почему в package.json используется angular 18? Этот прайм для 18 ангуляра? Как они вообще совместимы?

**Ответ:** package.json использует angular 18 и в демо странице действительно используется 18 ангуляр.
Но компоненты содержат свой package.json src/app/components/package.json в котором указана совместимость с 17 и 18 ангуляром.

### 6. А выложен ли где-то этот проект?

**Ответ:** Этот проект выложен в кубах и доступен по https://primeng-cdek.preproduction.k8s-local.cdek.ru/

## 8. TODO. Задачи и известные проблемы проекта.

-   [x] Создать пустые темы.
-   [x] Внедрить переменные от дизайнеров.
-   [] Добавить описание процесса компиляции темы для использования в других проектах.
-   [] Разобраться со сборкой в k8s. Есть проблема, что без package-lock.json проекты прайма не собираются.
